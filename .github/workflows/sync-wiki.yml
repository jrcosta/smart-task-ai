name: Sync Wiki

on:
  push:
    branches:
      - master
      - main
    paths:
      - 'wiki/**'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  sync-wiki:
    name: Sincronizar Wiki com GitHub Wiki
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout reposit√≥rio
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Configurar Git
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Clonar reposit√≥rio wiki
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git clone "https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.wiki.git" /tmp/wiki
      
      - name: Sincronizar arquivos
        run: |
          # Copiar arquivos da wiki para o reposit√≥rio wiki
          cp -r wiki/* /tmp/wiki/
          
      - name: Commit e Push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          cd /tmp/wiki
          
          # Verificar se h√° mudan√ßas
          if [ -z "$(git status --porcelain)" ]; then
            echo "‚úÖ Nenhuma mudan√ßa detectada na wiki"
            exit 0
          fi
          
          # Adicionar e commitar
          git add .
          git commit -m "Atualizar wiki (sincronizado do reposit√≥rio principal)"
          
          # Push para o reposit√≥rio wiki
          git push origin master || git push origin main
          
          echo "‚úÖ Wiki sincronizada com sucesso!"
          echo "üåê Acesse em: https://github.com/${{ github.repository }}/wiki"
